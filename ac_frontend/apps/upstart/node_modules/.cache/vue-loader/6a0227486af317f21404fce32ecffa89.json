{"remainingRequest":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\src\\views\\Articles.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\src\\views\\Articles.vue","mtime":1604395286150},{"path":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\node_modules\\@vue\\cli-service\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Go\\src\\alphacare\\ac_frontend\\apps\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5oYW5kbGUgewogICAgY3Vyc29yOiBtb3ZlOwp9CiNidXR0b25Db250YWluZXIgewogICAgbWFyZ2luLWxlZnQ6IGF1dG87Cn0KI3RpdGxlLWNvbnRhaW5lciB7CiAgbWF4LXdpZHRoOiAzMDBweDsKfQo="},{"version":3,"sources":["Articles.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Articles.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n\r\n    <div id=\"app\" >\r\n        <v-app id=\"inspire\" >\r\n            <div v-if=\"isLoading\">\r\n                <v-row justify=\"center\">\r\n                    <v-progress-circular indeterminate color=\"primary\"></v-progress-circular>\r\n                </v-row>\r\n            </div>\r\n            <div v-else>\r\n                <v-container class=\"my-2\" grid-list-sm>\r\n                    <v-layout>\r\n                        <v-flex xs12>\r\n                            <v-btn tile class=\"info\" @click=\"articleEditorDialog=true\">\r\n                                <v-icon dark>mdi-plus</v-icon>\r\n                                Add New Article\r\n                            </v-btn>\r\n                        </v-flex>\r\n                    </v-layout>\r\n                    <br>\r\n                    <draggable v-model=\"articles\" @change=\"saveOrder\" handle=\".handle\" v-if=\"this.articles && this.articles.length > 0\">\r\n                        <v-card :disabled=\"isSaving\" text v-for=\"(article, index) in articles\" :key=\"article.articleId\" class=\"handle\">\r\n                            <v-layout row wrap class=\"pa-2\">\r\n                                <v-flex xs2 sm2 md1>\r\n                                    <div class=\"caption grey--text ml-9\">No.</div>\r\n                                    <div :class=\"{'mt-0 mb-1': $vuetify.breakpoint.smAndDown}\">\r\n                                      <v-tooltip bottom>\r\n                                        <template v-slot:activator=\"{ on, attrs }\">\r\n                                          <v-icon size=\"35\" color=\"primary\" v-bind=\"attrs\" v-on=\"on\" >drag_indicator</v-icon>\r\n                                        </template>\r\n                                        <span>Drag to move</span>\r\n                                      </v-tooltip>\r\n                                        {{index + 1}}\r\n                                    </div>\r\n                                </v-flex>\r\n\r\n                                <v-flex xs4 sm4 md4>\r\n                                    <div class=\"caption grey--text mb-1\">Title</div>\r\n                                    <div :class=\"{'mt-0 mb-1': $vuetify.breakpoint.smAndDown}\" id=\"title-container\">\r\n                                        {{ article.title }}\r\n                                    </div>\r\n                                </v-flex>\r\n\r\n                                <v-flex xs2 sm2 md3>\r\n                                    <div class=\"caption grey--text mb-1\">Updated on</div>\r\n                                    <div :class=\"{'mt-0 mx-0 px-0': $vuetify.breakpoint.smAndDown}\" v-html=\"convertToDate(article.updatedAt)\"></div>\r\n                                </v-flex>\r\n\r\n                                <v-flex xs1 sm2 md2 class=\"pt-0\">\r\n                                    <div class=\"mt-0 pt-0\">\r\n                                        <v-switch v-model=\"article.isLive\" @click=\"changeState(index)\" :label=\"`${article.isLive ? 'ON' : 'OFF'}`\"></v-switch>\r\n                                    </div>\r\n                                </v-flex>\r\n                                <v-spacer></v-spacer>\r\n                                <v-flex xs2 sm2 md2 class=\"mt-0 pt-3\" id=\"buttonContainer\">\r\n                                    <v-row class=\"ml-10\">\r\n                                    <div>\r\n                                      <v-tooltip bottom>\r\n                                        <template v-slot:activator=\"{ on, attrs }\">\r\n                                          <v-btn icon :class=\"article\" @click=\"openArticleEditor(index)\" v-bind=\"attrs\" v-on=\"on\" class=\"pa-3 ma-0\"><v-icon size=\"35\" color=\"primary\">edit</v-icon></v-btn>\r\n                                        </template>\r\n                                        <span>Edit</span>\r\n                                      </v-tooltip>\r\n                                      <v-tooltip bottom>\r\n                                        <template v-slot:activator=\"{ on, attrs }\">\r\n                                          <v-btn icon :class=\"article\" @click=\"openSendTestEmailDialog(index)\" v-bind=\"attrs\" v-on=\"on\" class=\"pa-3 ma-0\"><v-icon size=\"35\" color=\"green\">mdi-email-send-outline</v-icon></v-btn>\r\n                                        </template>\r\n                                        <span>Send</span>\r\n                                      </v-tooltip>\r\n                                      <v-tooltip bottom>\r\n                                        <template v-slot:activator=\"{ on, attrs }\">\r\n                                          <v-btn icon :class=\"article\" @click=\"openDialog(index)\" v-bind=\"attrs\" v-on=\"on\"  class=\"pa-0 ma-0\"><v-icon size=\"35\" color=\"grey\">delete</v-icon></v-btn>\r\n                                        </template>\r\n                                        <span>Delete</span>\r\n                                      </v-tooltip>\r\n                                    </div>\r\n                                    </v-row>\r\n                                </v-flex>\r\n                            </v-layout>\r\n                        </v-card>\r\n                    </draggable>\r\n                    <v-row justify=\"center\">\r\n                        <v-dialog v-model=\"dialog\" max-width=\"250\">\r\n                            <confirm-dialog v-bind:title=\"`Are you sure?`\" :body=\"`The action is not reversible.`\" @yes=\"deleteArticle\" @no=\"dialog=false\"></confirm-dialog>\r\n                        </v-dialog>\r\n                    </v-row>\r\n                </v-container>\r\n                <v-container>\r\n                    <v-row justify=\"center\">\r\n                        <v-dialog v-if=\"articleEditorDialog\" v-model=\"articleEditorDialog\" fullscreen hide-overlay transition=\"dialog-bottom-transition\">\r\n                            <article-editor v-bind:article=\"articles && selectedIndex >= 0 ? Object.assign({}, articles[selectedIndex]) : {}\" @save=\"onSave\" @create=\"onCreate\" @closeEditor=\"onCloseEditor\"></article-editor>\r\n                        </v-dialog>\r\n                    </v-row>\r\n                </v-container>\r\n                <v-container>\r\n                  <v-row justify=\"center\">\r\n                    <v-dialog v-if=\"sendTestEmailDialog\" v-model=\"sendTestEmailDialog\" max-width=\"350\">\r\n                      <email-address-card :email-address=\"project.outgoingEmail\" @send=\"sendTestEmail\" @close=\"closeSendTestEmailDialog\"></email-address-card>\r\n                    </v-dialog>\r\n                  </v-row>\r\n                </v-container>\r\n                <v-container>\r\n                  <v-row>\r\n                    <v-snackbar v-model=\"messageSnackbar\">\r\n                      {{ displayMessage }}\r\n                      <template v-slot:action=\"{ attrs }\">\r\n                        <v-btn\r\n                            color=\"pink\"\r\n                            text\r\n                            v-bind=\"attrs\"\r\n                            @click=\"snackbar = false\"\r\n                        >\r\n                          Close\r\n                        </v-btn>\r\n                      </template>\r\n                    </v-snackbar>\r\n                  </v-row>\r\n                </v-container>\r\n            </div>\r\n        </v-app>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\n    import axios from \"axios\";\r\n    import {default as API_ENDPOINTS} from \"../api\";\r\n    import Draggable from 'vuedraggable';\r\n    import ConfirmDialog from \"../components/ConfirmDialog\";\r\n    import ArticleEditor from \"../components/ArticleEditor\";\r\n    import EmailAddressCard from \"@/components/EmailAddressCard\";\r\n\r\n    export default {\r\n        components: {EmailAddressCard, Draggable, ConfirmDialog, ArticleEditor},\r\n        data() {\r\n            return {\r\n                projectId: '',\r\n                project: {},\r\n                articles: [],\r\n                dialog: false,\r\n                selectedIndex: -1,\r\n                isSaving: false,\r\n                articleEditorDialog: false,\r\n                isLoading: false,\r\n                sendTestEmailDialog: false,\r\n                messageSnackbar: false,\r\n                displayMessage: \"\"\r\n            }\r\n        },\r\n        watch: {\r\n        },\r\n        methods: {\r\n            openSendTestEmailDialog(index) {\r\n              this.sendTestEmailDialog = true\r\n              this.selectedIndex = index\r\n            },\r\n            closeSendTestEmailDialog() {\r\n              this.sendTestEmailDialog = false\r\n              this.selectedIndex = -1\r\n            },\r\n            sendTestEmail(to) {\r\n              this.sendEmail(this.project.outgoingEmail, to, this.articles[this.selectedIndex].title,\r\n                  this.articles[this.selectedIndex].htmlBody).then(() => {\r\n                  this.closeSendTestEmailDialog()\r\n                  this.showSnackBar(\"Message sent to \" + to)\r\n              }).catch(() => {\r\n                  this.closeSendTestEmailDialog()\r\n                  this.showSnackBar(\"Failed to send message to \" + to)\r\n              })\r\n            },\r\n            showSnackBar(msg) {\r\n              this.displayMessage = msg\r\n              this.messageSnackbar = true\r\n              setTimeout(function(){\r\n                this.messageSnackbar = false\r\n              }, 2000);\r\n            },\r\n            onSave(editedArticle) {\r\n                this.updateArticle(editedArticle).then(resp => {\r\n                    this.articles.splice(this.selectedIndex, 1, resp.data)\r\n                    this.articleEditorDialog = false\r\n                    this.selectedIndex = -1\r\n                })\r\n            },\r\n            onCreate(article) {\r\n                this.createArticle(article).then(resp => {\r\n                    this.articles.push(resp.data)\r\n                    this.articleEditorDialog = false\r\n                })\r\n            },\r\n            onCloseEditor() {\r\n                this.articleEditorDialog = false\r\n                this.selectedIndex = -1\r\n            },\r\n            changeState(index) {\r\n                this.UpdateArticleByIndex(index)\r\n            },\r\n            UpdateArticleByIndex(index) {\r\n                const article = this.articles[index]\r\n                this.updateArticle(article).then(resp => {\r\n                    this.articles.splice(index, 1, resp.data)\r\n                })\r\n            },\r\n            createArticle(article) {\r\n                const data = {email: this.project.email, projectId: this.projectId, isLive: article.isLive, title: article.title, htmlBody: article.htmlBody, textBody: article.textBody}\r\n                return new Promise((resolve, reject) => {\r\n                    axios({url: API_ENDPOINTS.CREATE_ARTICLE, data: data, method: 'POST' })\r\n                        .then(resp => {\r\n                            resolve(resp)\r\n                            return resp\r\n                        })\r\n                        .catch(err => {\r\n                            reject(err)\r\n                        })\r\n                })\r\n            },\r\n            updateArticle(article) {\r\n                const data = {email: this.$store.getters.email, article: article}\r\n                return new Promise((resolve, reject) => {\r\n                    axios({url: API_ENDPOINTS.UPDATE_ARTICLE, data: data, method: 'PUT' })\r\n                        .then(resp => {\r\n                            resolve(resp)\r\n                            return resp\r\n                        })\r\n                        .catch(err => {\r\n                            reject(err)\r\n                        })\r\n                })\r\n            },\r\n            convertToDate(timestampMs) {\r\n                if (timestampMs > 0) {\r\n                    const date = new Date(timestampMs)\r\n                    return date.toLocaleDateString()\r\n                }\r\n                return \"\"\r\n            },\r\n            saveOrder() {\r\n                let newArticleIds = []\r\n                for (let i = 0; i < this.articles.length; i++) {\r\n                    newArticleIds.push(this.articles[i].articleId)\r\n                }\r\n                this.project.articleIds = newArticleIds\r\n                this.saveProject()\r\n            },\r\n            saveProject() {\r\n                this.isSaving = true\r\n                const data = {email: this.$store.getters.email, project: this.project}\r\n                return new Promise((resolve, reject) => {\r\n                    axios({url: API_ENDPOINTS.UPDATE_PROJECT, data: data, method: 'PUT' })\r\n                        .then(resp => {\r\n                            resolve(resp)\r\n                            this.project = resp.data\r\n                            this.readArticles()\r\n                            this.isSaving = false\r\n                        })\r\n                        .catch(err => {\r\n                            reject(err)\r\n                        })\r\n                })\r\n            },\r\n            openArticleEditor(index) {\r\n                this.selectedIndex = index\r\n                this.articleEditorDialog = true\r\n            },\r\n            openDialog(index) {\r\n                this.dialog = true\r\n                this.selectedIndex = index\r\n            },\r\n            deleteArticle() {\r\n                const projectId = this.articles[this.selectedIndex].projectId\r\n                const articleId = this.articles[this.selectedIndex].articleId\r\n                const data = {requesterEmail: this.$store.getters.email}\r\n                return new Promise((resolve, reject) => {\r\n                    axios({url: API_ENDPOINTS.DELETE_ARTICLE(this.$store.getters.email, projectId, articleId), params: data, method: 'DELETE' })\r\n                        .then(resp => {\r\n                            resolve(resp)\r\n                            this.project.articleIds.splice(this.selectedIndex, 1)\r\n                            this.articles.splice(this.selectedIndex, 1)\r\n                            this.dialog = false\r\n                        })\r\n                        .catch(err => {\r\n                            reject(err)\r\n                        })\r\n                })\r\n            },\r\n            readProject() {\r\n                this.isLoading = true\r\n                const data = {requesterEmail: this.$store.getters.email}\r\n                return new Promise((resolve, reject) => {\r\n                    axios({url: API_ENDPOINTS.READ_PROJECT(this.$store.getters.email, this.projectId), params: data, method: 'GET' })\r\n                        .then(resp => {\r\n                            resolve(resp)\r\n                            this.project = resp.data\r\n                            this.readArticles()\r\n                        })\r\n                        .catch(err => {\r\n                            reject(err)\r\n                        })\r\n                })\r\n            },\r\n            readArticles() {\r\n                return new Promise((resolve, reject) => {\r\n                    let data = {email: this.$store.getters.email ? this.$store.getters.email : this.project.email}\r\n                    if (this.project?.articleIds?.length > 0) {\r\n                        data.articleIds = this.project.articleIds\r\n                    }\r\n                    axios({url: API_ENDPOINTS.READ_ARTICLES, data: data, method: 'POST' })\r\n                        .then(resp => {\r\n                            resolve(resp)\r\n                            this.articles = resp.data\r\n                            this.isLoading = false\r\n                        })\r\n                        .catch(err => {\r\n                            reject(err)\r\n                        })\r\n                })\r\n            },\r\n            sendEmail(from, to, subject, message) {\r\n              return new Promise((resolve, reject) => {\r\n                let data = {email: this.$store.getters.email ? this.$store.getters.email : this.project.email,\r\n                  from: from, to: to, message: message, subject: subject, projectId: this.project.projectId,\r\n                  projectName: this.project.name}\r\n                axios({url: API_ENDPOINTS.SEND_EMAIL, data: data, method: 'POST' })\r\n                    .then(resp => {\r\n                      resolve(resp)\r\n                    })\r\n                    .catch(err => {\r\n                      reject(err)\r\n                    })\r\n              })\r\n            },\r\n            isLogin() {\r\n                if (!this.$store.getters.isLoggedIn || !this.$store.getters.email) {\r\n                    console.log(\"not signed in \");\r\n                    this.$router.push('/')\r\n                    return false\r\n                }\r\n                return true\r\n            },\r\n        },\r\n        created: function () {\r\n            if (!this.isLogin() || !this.$route.params || !this.$route.params.projectId) {\r\n              this.$router.push('/dashboard')\r\n            }\r\n            this.projectId = this.$route.params.projectId\r\n            if (!this.$route.params.project) {\r\n                this.readProject()\r\n            } else {\r\n                this.project = this.$route.params.project\r\n                this.readArticles()\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n\r\n<style>\r\n    .handle {\r\n        cursor: move;\r\n    }\r\n    #buttonContainer {\r\n        margin-left: auto;\r\n    }\r\n    #title-container {\r\n      max-width: 300px;\r\n    }\r\n</style>\r\n"]}]}